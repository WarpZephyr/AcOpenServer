# AcOpenServer
A project aimed at recreating the 5th generation Armored Core servers.  

# Progress
Currently still working on the base server code and getting past the authentication step.

# Getting Started
To start testing the server:  
First setup RPCS3 for Armored Core Verdict Day;  
This will override the server IP in the game.  
1. Get RPCS3  
2. Obtain a copy of Armored Core Verdict Day for RPCS3 to use  
3. Make an RPCN account for RPCS3  
4. In RPCS3, create a Custom Configuration for Armored Core Verdict Day  
5. Open Armored Core Verdict Day's Custom Configuration in RPCS3  
6. Go to the Network tab  
7. Set Network Status to Connected  
8. Set PSN Status to RPCN  
9. Set IP/Hosts switches to acvd-ps3-ww.fromsoftware.jp=127.0.0.1  
10. Save the Custom Configuration  

Next replace the RSA keypair used by Armored Core Verdict Day;  
This will allow the server to communicate with the game.  
You will need to either modify the main archive, or modify the files in an unbound copy of the game;  
The main archive is kept under "RPCS3_FOLDER/dev_hdd0/game/REGION_CODE/USRDIR/bind" for digital copies and the game install.  
It is kept under "GAME_FOLDER/PS3_GAME/USRDIR/bind" for disc copies.  
It comes in two parts: "dvdbnd5_layer0.bhd" and "dvdbnd_layer0.bdt"  

To create an in-place unbound copy use [ACVLooseLoader](https://github.com/WarpZephyr/ACVLooseLoader/releases) (Recommended)  
To unpack and repack the main archive use [DVDUnbinder](https://github.com/WarpZephyr/DVDUnbinder/releases)  

1. Go to the game files folder;  
      - In an unbound copy this is under "GAME_FOLDER/PS3_GAME/USRDIR/";  
	  - In an unpacked copy this is directly under the unpack folder  
2. Go to the system folder;  
3. Replace publickey.pem with one generated by running AcOpenServer  

If unpacking and repacking, use [DVDUnbinder](https://github.com/WarpZephyr/DVDUnbinder/releases) to now repack the main archive.  
If you see no change, make sure the installed game archive under "RPCS3_FOLDER/dev_hdd0/game/BLUS31194/USRDIR/bind" is replaced.  
BLUS31194 is the region code for the PS3 US Armored Core Verdict Day on disc, replace as necessary.  

The server makes keys under the "Saved/SERVER_NAME" folder,  
SERVER_NAME being the name of the server instance.  
Default is a server made by default.  

# Building
Currently only building on windows is directly supported.  
However adding other platforms may be doable.  

Make sure the project is not under strange folders.  
Try to have no folders with spaces, -, or # in the path.  
Ideally try to have no folders with symbols in the path.  
This is because the native projects use CMake and it may not like odd paths.  

First build the native libraries:  
1. Go to the native/tools folder  
2. Run native_generate_vs2022.bat  
3. Go back to the native folder  
4. Go to native/generated/vs2022 and open native.sln  
5. Build in Visual Studio 2022  

In the native folder a bin folder will be generated, managed wrapper projects point at binaries built in here.  
Finally build the AcOpenServer.sln in VS 2022.

# Credits
Massive thanks to [ds3os](https://github.com/TLeonardUK/ds3os), it's research website [timleonard.uk](https://timleonard.uk), and related authors;  
Much of the code is based on concepts presented by [ds3os](https://github.com/TLeonardUK/ds3os), and the native libraries around cryptography are mostly directly borrowed from it.